<h1 class="admin-title">ğŸ‘¥ ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±è©³ç´°</h1>
<form method="GET" action="/admin/users" class="admin-search-form">
  <input type="text" name="q" placeholder="ãƒ¦ãƒ¼ã‚¶ãƒ¼å" value="<%= typeof query !== 'undefined' ? query : '' %>" list="user-suggest" class="admin-search-input">
  <datalist id="user-suggest"></datalist>
  <button type="submit" class="btn btn-success">æ¤œç´¢</button>
</form>
<script>
// ã‚µã‚¸ã‚§ã‚¹ãƒˆç”¨ãƒ¦ãƒ¼ã‚¶ãƒ¼åå–å¾—
fetch('/admin/api/user-names').then(res => res.json()).then(list => {
  const datalist = document.getElementById('user-suggest');
  datalist.innerHTML = list.map(name => `<option value="${name}">`).join('');
});
</script>
<!-- æ–°è¦ãƒ¦ãƒ¼ã‚¶ãƒ¼è¿½åŠ ãƒ•ã‚©ãƒ¼ãƒ  -->
<form method="POST" action="/admin/users/add" class="admin-add-user-form">
  <input type="text" name="username" placeholder="ãƒ¦ãƒ¼ã‚¶ãƒ¼å" required class="admin-add-user-input">
  <input type="password" name="password" placeholder="ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰" required class="admin-add-user-input">
  <select name="role" class="admin-add-user-select">
    <option value="user">ä¸€èˆ¬</option>
    <option value="admin">ç®¡ç†è€…</option>
  </select>
  <button type="submit" class="btn btn-success">ãƒ¦ãƒ¼ã‚¶ãƒ¼è¿½åŠ </button>
</form>
<style>
.admin-user-table td, .admin-user-table th {
  text-align: center;
  vertical-align: middle;
}
</style>
<table class="admin-user-table">
  <thead>
    <tr class="admin-user-table-header">
      <th class="admin-user-th">ID</th>
      <th class="admin-user-th">ãƒ¦ãƒ¼ã‚¶ãƒ¼å</th>
      <th class="admin-user-th">æ¨©é™</th>
      <th class="admin-user-th">çŠ¶æ…‹</th>
      <th class="admin-user-th">æ“ä½œ</th>
    </tr>
  </thead>
  <tbody>
    <% users.forEach(function(u) { %>
      <tr>
        <td class="admin-user-td"><%= u.id %></td>
        <td class="admin-user-td">
          <form method="POST" action="/admin/users/update-name" class="admin-inline-form">
            <input type="hidden" name="id" value="<%= u.id %>">
            <input type="text" name="username" value="<%= u.username %>" class="admin-inline-input">
            <button type="submit" class="btn btn-success admin-inline-btn">ä¿å­˜</button>
          </form>
        </td>
        <td class="admin-user-td">
          <form method="POST" action="/admin/users/update-role" class="admin-inline-form">
            <input type="hidden" name="id" value="<%= u.id %>">
            <select name="role" class="admin-inline-select">
              <option value="user" <%= !u.isAdmin ? 'selected' : '' %>>ä¸€èˆ¬</option>
              <option value="admin" <%= u.isAdmin ? 'selected' : '' %>>ç®¡ç†è€…</option>
            </select>
            <button type="submit" class="btn btn-success admin-inline-btn">ä¿å­˜</button>
          </form>
        </td>
        <td class="admin-user-td">
          <% if (u.locked) { %>
            <form method="POST" action="/admin/users/unlock" class="admin-inline-form"><input type="hidden" name="id" value="<%= u.id %>"><button type="submit" class="btn btn-danger admin-inline-btn">ã‚¢ãƒ³ãƒ­ãƒƒã‚¯</button></form>
          <% } else { %>
            <form method="POST" action="/admin/users/lock" class="admin-inline-form"><input type="hidden" name="id" value="<%= u.id %>"><button type="submit" class="btn btn-danger admin-inline-btn">ãƒ­ãƒƒã‚¯</button></form>
          <% } %>
        </td>
        <td class="admin-user-td">
          <form method="POST" action="/admin/users/delete" class="admin-inline-form" onsubmit="return confirm('æœ¬å½“ã«å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ');">
            <input type="hidden" name="id" value="<%= u.id %>">
            <button type="submit" class="btn btn-danger admin-inline-btn">å‰Šé™¤</button>
          </form>
          <form method="POST" action="/admin/users/update-password" class="admin-inline-form admin-inline-form-pw">
            <input type="hidden" name="id" value="<%= u.id %>">
            <input type="password" name="password" placeholder="æ–°ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰" class="admin-inline-input">
            <button type="submit" class="btn btn-success admin-inline-btn">PWå¤‰æ›´</button>
          </form>
        </td>
      </tr>
    <% }); %>
  </tbody>
</table>

<!-- TODO: ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ä¸€è¦§ã‚’è¿½åŠ  --> 