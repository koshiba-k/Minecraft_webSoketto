<h1 style="margin-bottom: 30px; color: #2d3748;">📊 統計情報詳細</h1>
<form method="GET" action="/admin/stats" style="margin-bottom: 2rem; display: flex; gap: 1rem; align-items: center;">
  <input type="text" name="item" placeholder="アイテム名で検索" value="<%= typeof itemName !== 'undefined' ? itemName : '' %>" list="item-suggest" style="padding: 0.5rem 1rem; border-radius: 0.4rem; border: 1px solid #e2e8f0; font-size: 1rem;">
  <datalist id="item-suggest"></datalist>
  <button type="submit" class="btn btn-success">検索</button>
</form>

<% if (itemImagePath) { %>
  <div style="text-align:center; margin-bottom:1.5rem;">
    <img src="<%= itemImagePath %>" alt="<%= itemName %>" style="width:80px; height:80px; object-fit:contain; background:#fff; border-radius:0.5rem; border:1px solid #e2e8f0;">
    <div style="margin-top:0.5rem; color:#232f3e; font-weight:bold;"><%= itemName %></div>
  </div>
<% } %>

<% if (chartData && chartData.purchaseCounts) { %>
  <div style="max-width: 700px; margin: 0 auto 2rem auto;">
    <canvas id="purchaseChart" width="700" height="350"></canvas>
  </div>
  <div style="max-width: 700px; margin: 0 auto 2rem auto;">
    <canvas id="salesChart" width="700" height="350"></canvas>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    const purchaseData = <%- JSON.stringify(chartData.purchaseCounts) %>;
    const salesData = <%- JSON.stringify(chartData.salesSums) %>;
    const labels = <%- JSON.stringify(chartData.labels) %>;
    new Chart(document.getElementById('purchaseChart').getContext('2d'), {
      type: 'bar',
      data: { labels, datasets: [{ label: '日別購入数', data: purchaseData, backgroundColor: '#4299e1' }] },
      options: { responsive: true, plugins: { legend: { display: false } } }
    });
    new Chart(document.getElementById('salesChart').getContext('2d'), {
      type: 'line',
      data: { labels, datasets: [{ label: '累計売上', data: salesData, borderColor: '#ff9900', backgroundColor: 'rgba(255,153,0,0.1)', fill: true }] },
      options: { responsive: true }
    });
  </script>
<% } %>

<p>ここでアイテムごとの検索やグラフ化（購入日・数量）を行えるようにします。</p>
<!-- TODO: 検索フォーム・グラフ表示UIを追加 -->

<script>
// サジェスト用アイテム名取得
fetch('/admin/api/item-names').then(res => res.json()).then(list => {
  const datalist = document.getElementById('item-suggest');
  datalist.innerHTML = list.map(name => `<option value="${name}">`).join('');
});
</script> 