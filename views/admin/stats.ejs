<h1 style="margin-bottom: 30px; color: #2d3748;">ğŸ“Š çµ±è¨ˆæƒ…å ±è©³ç´°</h1>
<form method="GET" action="/admin/stats" style="margin-bottom: 2rem; display: flex; gap: 1rem; align-items: center;">
  <input type="text" name="item" placeholder="ã‚¢ã‚¤ãƒ†ãƒ åã§æ¤œç´¢" value="<%= typeof itemName !== 'undefined' ? itemName : '' %>" list="item-suggest" style="padding: 0.5rem 1rem; border-radius: 0.4rem; border: 1px solid #e2e8f0; font-size: 1rem;">
  <datalist id="item-suggest"></datalist>
  <button type="submit" class="btn btn-success">æ¤œç´¢</button>
</form>

<% if (itemImagePath) { %>
  <div style="text-align:center; margin-bottom:1.5rem;">
    <img src="<%= itemImagePath %>" alt="<%= itemName %>" style="width:80px; height:80px; object-fit:contain; background:#fff; border-radius:0.5rem; border:1px solid #e2e8f0;">
    <div style="margin-top:0.5rem; color:#232f3e; font-weight:bold;"><%= itemName %></div>
  </div>
<% } %>

<% if (chartData && chartData.purchaseCounts) { %>
  <div style="max-width: 700px; margin: 0 auto 2rem auto;">
    <canvas id="purchaseChart" width="700" height="350"></canvas>
  </div>
  <div style="max-width: 700px; margin: 0 auto 2rem auto;">
    <canvas id="salesChart" width="700" height="350"></canvas>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    const purchaseData = <%- JSON.stringify(chartData.purchaseCounts) %>;
    const salesData = <%- JSON.stringify(chartData.salesSums) %>;
    const labels = <%- JSON.stringify(chartData.labels) %>;
    new Chart(document.getElementById('purchaseChart').getContext('2d'), {
      type: 'bar',
      data: { labels, datasets: [{ label: 'æ—¥åˆ¥è³¼å…¥æ•°', data: purchaseData, backgroundColor: '#4299e1' }] },
      options: { responsive: true, plugins: { legend: { display: false } } }
    });
    new Chart(document.getElementById('salesChart').getContext('2d'), {
      type: 'line',
      data: { labels, datasets: [{ label: 'ç´¯è¨ˆå£²ä¸Š', data: salesData, borderColor: '#ff9900', backgroundColor: 'rgba(255,153,0,0.1)', fill: true }] },
      options: { responsive: true }
    });
  </script>
<% } %>

<p>ã“ã“ã§ã‚¢ã‚¤ãƒ†ãƒ ã”ã¨ã®æ¤œç´¢ã‚„ã‚°ãƒ©ãƒ•åŒ–ï¼ˆè³¼å…¥æ—¥ãƒ»æ•°é‡ï¼‰ã‚’è¡Œãˆã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚</p>
<!-- TODO: æ¤œç´¢ãƒ•ã‚©ãƒ¼ãƒ ãƒ»ã‚°ãƒ©ãƒ•è¡¨ç¤ºUIã‚’è¿½åŠ  -->

<script>
// ã‚µã‚¸ã‚§ã‚¹ãƒˆç”¨ã‚¢ã‚¤ãƒ†ãƒ åå–å¾—
fetch('/admin/api/item-names').then(res => res.json()).then(list => {
  const datalist = document.getElementById('item-suggest');
  datalist.innerHTML = list.map(name => `<option value="${name}">`).join('');
});
</script> 